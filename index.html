!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>LEGEND OF YMIR DIAMOND üíé</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
  :root{
    --txt:#fff7fb; --mut:#ccb9c1; --mut2:#a8989f;
    --green:#21d072; --blue:#1877f2; --discord:#5865f2;
    --red1:#1a0f14; --red2:#120a10; --ink:#09060a;
    --border: rgba(255,100,140,.18);
    --ring: conic-gradient(#ff2b63,#ff6ea0,#ff2b63);
    --glow-soft: 0 0 16px rgba(255,40,100,.22);
    --chip:#222027;
  }
  *{box-sizing:border-box}
  html,body{margin:0;color:var(--txt);font-family:Poppins,system-ui,Segoe UI,Roboto,Arial,sans-serif;background:var(--ink);min-height:100%}

  /* Animated dark red background */
  body::before{
    content:"";position:fixed;inset:-20% -20%;z-index:-3;pointer-events:none;
    background:
      radial-gradient(40% 30% at 15% 10%, rgba(255,40,100,.14), transparent 60%),
      radial-gradient(38% 28% at 85% 5%, rgba(200,20,80,.10), transparent 65%),
      radial-gradient(55% 40% at 50% 110%, rgba(255,30,100,.10), transparent 72%);
    filter: blur(10px) saturate(112%);
    animation:bgFloat 16s ease-in-out infinite alternate;
  }
  @keyframes bgFloat{0%{transform:translate3d(0,0,0)}100%{transform:translate3d(1.2%,-1.2%,0)}}
  body::after{
    content:"";position:fixed;inset:0;z-index:-2;pointer-events:none;opacity:.45;
    background:
      radial-gradient(circle at 18% 28%, rgba(255,80,130,.25) 0 1px, transparent 2px),
      radial-gradient(circle at 78% 18%, rgba(255,60,110,.22) 0 1px, transparent 2px),
      radial-gradient(circle at 68% 78%, rgba(255,50,100,.20) 0 1px, transparent 2px),
      radial-gradient(circle at 28% 82%, rgba(255,70,120,.18) 0 1px, transparent 2px);
    animation:spark 11s linear infinite;
  }
  @keyframes spark{0%{transform:translateY(0)}100%{transform:translateY(-8px)}}

  .wrap{max-width:760px;margin:auto;padding:16px 14px 140px}
  .title{display:flex;gap:10px;justify-content:center;font-weight:800;font-size:22px;letter-spacing:.4px;margin:2px 0 8px;text-shadow:0 0 10px rgba(255,70,120,.25)}

  /* Logo */
  .logoWrap{display:grid;place-items:center;margin:6px 0 8px}
  .logo{width:min(44vw,186px);aspect-ratio:1/1;border-radius:999px;position:relative;display:grid;place-items:center;background:radial-gradient(120px 110px at 50% 50%, #0e0a0d 40%, #000 100%);box-shadow:0 0 0 8px rgba(0,0,0,.55); cursor:pointer}
  .ring{position:absolute;inset:10px;border-radius:999px;background:var(--ring);filter:blur(.55px);-webkit-mask:radial-gradient(circle, transparent 61.5%, #000 63%);mask:radial-gradient(circle, transparent 61.5%, #000 63%);animation:spin 9s linear infinite;opacity:.55}
  @keyframes spin{to{transform:rotate(360deg)}}
  .logo img{width:82%;border-radius:999px;box-shadow:0 0 18px rgba(255,40,100,.28)}

  /* Owner */
  .owner{margin:10px auto 8px;display:flex;gap:10px;align-items:center;justify-content:center;padding:10px 12px;border-radius:14px;background:linear-gradient(180deg,#131218,#0d0c12);border:1px solid rgba(255,255,255,.10);box-shadow:0 0 16px rgba(0,0,0,.25);font-weight:800;max-width:560px}
  .owner a{color:#fff;text-decoration:none;display:inline-flex;align-items:center;gap:8px}
  .ownerName{letter-spacing:.3px}
  .metaBadge{width:22px;height:22px;display:inline-block;filter: drop-shadow(0 0 10px rgba(24,119,242,.45))}

  /* Tiers */
  .row{display:grid;gap:12px}
  .prices{display:grid;grid-template-columns:repeat(3,1fr);margin:6px 0 10px}
  .pill{position:relative;background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,.00));border:1px solid var(--border);border-radius:18px;padding:12px;text-align:center;box-shadow:inset 0 0 0 1px rgba(255,30,80,.06), var(--glow-soft);transition:transform .18s, box-shadow .18s, border-color .18s, opacity .18s}
  .pval{font-size:26px;font-weight:900}
  .ptxt{font-size:12px;color:#ccb9c1}
  .pill.active{transform:translateY(-2px) scale(1.02);border-color:rgba(80,255,170,.55);box-shadow:0 0 20px rgba(40,255,170,.26), inset 0 0 0 1px rgba(40,255,170,.28)}
  .dealChip{position:absolute; top:-10px; right:-10px;background:linear-gradient(180deg,#ffb66a,#ff7b2c);color:#2b1200; font-weight:900; font-size:11px;padding:6px 8px; border-radius:999px; box-shadow:0 8px 22px rgba(255,120,0,.35);border:1px solid rgba(255,255,255,.35);display:none}
  .pill.best .dealChip{display:flex;align-items:center;gap:6px}

  /* Card / Inputs */
  .section{background:linear-gradient(180deg,var(--red1),var(--red2));border:1px solid var(--border);border-radius:18px;padding:14px;box-shadow:var(--glow-soft)}
  .label{font-size:13px;color:#ccb9c1;margin:4px 2px 6px}
  .in{width:100%;border:1px solid rgba(255,120,160,.20);background:#0b090c;color:#fff;padding:14px;border-radius:14px;font-size:18px;outline:none;box-shadow:inset 0 0 14px rgba(255,20,80,.06), 0 0 12px rgba(255,40,100,.12)}
  .in:focus{border-color:#ff6aa1;box-shadow:0 0 0 3px rgba(255,60,110,.16), var(--glow-soft)}
  .hint{font-size:12px;color:#a8989f;margin-top:6px}
  .warn{margin-top:8px;font-size:12px;color:#ff7b94;display:none}
  .grid2{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:10px}
  .box{background:linear-gradient(180deg,#1a1218,#120e13);border:1px solid rgba(255,120,160,.18);border-radius:16px;padding:12px;text-align:center;box-shadow:var(--glow-soft)}
  .box h5{margin:0 0 4px;font-size:12px;color:#ccb9c1}
  .rateOut{font-weight:900;font-size:20px}
  .saveOut{font-weight:900;font-size:20px;color:#baffd6}
  .saveBox{background:linear-gradient(180deg,#0f2117,#0a1a11);border-color:rgba(40,255,160,.24)}

  /* Buttons */
  .btn{display:inline-flex;align-items:center;justify-content:center;gap:10px;border:none;border-radius:14px;padding:14px 16px;font-weight:800;letter-spacing:.2px;cursor:pointer;user-select:none}
  .buy{background:var(--green);color:#092112;font-size:18px;box-shadow:0 18px 44px rgba(33,208,114,.24), inset 0 -6px 0 rgba(0,0,0,.12);width:100%;margin-top:10px;transition:transform .12s}
  .buy:active{transform:translateY(1px)}
  .btn[disabled]{opacity:.55;filter:grayscale(.25);cursor:not-allowed}

  /* Payment + socials */
  .pay{background:linear-gradient(180deg,#11111a,#0b0c12);border:1px solid rgba(24,119,242,.18);border-radius:18px;padding:12px 14px;box-shadow:0 0 18px rgba(24,119,242,.12);margin-top:10px}
  .gcashRow{
    display:flex;align-items:center;gap:12px;justify-content:space-between;
    background:rgba(24,119,242,.08);border:1px solid rgba(24,119,242,.28);
    padding:10px 12px;border-radius:12px;max-width:560px;margin:8px auto 10px;
    box-shadow: 0 10px 24px rgba(24,119,242,.10); font-weight:800; cursor:pointer
  }
  .gcashLeft{display:flex;align-items:center;gap:10px}
  .gcashIcon{
    width:26px;height:26px;border-radius:999px;background:#1877f2;display:grid;place-items:center;
    box-shadow:0 0 10px rgba(24,119,242,.35), inset 0 0 8px rgba(255,255,255,.14);
    font-weight:900;color:#fff;letter-spacing:.2px;user-select:none;
  }
  .qrBtn{display:inline-flex;align-items:center;gap:8px;background:rgba(24,119,242,.14);color:#eaf3ff;border:1px solid rgba(24,119,242,.38);padding:8px 12px;border-radius:10px;font-weight:800}
  .qrBtn svg{filter:drop-shadow(0 0 6px rgba(24,119,242,.42))}
  .soc{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:10px}
  .btnlink{display:inline-flex;align-items:center;justify-content:center;gap:10px;border-radius:14px;padding:14px 16px;font-weight:800;letter-spacing:.2px;text-decoration:none}
  .fb{background:var(--blue);color:#fff}
  .dc{background:var(--discord);color:#fff}

  /* Notice */
  .notice{margin-top:12px;padding:12px 14px;border-radius:14px;background:linear-gradient(180deg,#17141a,#120f14);border:1px solid rgba(255,255,255,.12);box-shadow:0 0 16px rgba(0,0,0,.25)}
  .notice h4{margin:0 0 6px;font-size:14px}
  .notice p{margin:0;color:#ccb9c1;font-size:13px}

  /* Track Order */
  .track{margin-top:14px;background:linear-gradient(180deg,#151218,#100f13);border:1px solid rgba(255,255,255,.10);border-radius:14px;padding:14px;box-shadow:0 0 16px rgba(0,0,0,.25)}
  .chip{display:inline-flex;gap:8px;align-items:center;background:var(--chip);border:1px solid rgba(255,255,255,.08);padding:8px 12px;border-radius:12px}

  /* Popups */
  #buyPopup, #gcashPopup, #qrPopup, #goPopup, #goQRPopup, #invModal{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;place-items:center;z-index:70}
  .cardPop{width:min(92vw,520px);background:#0f0d10;border:1px solid var(--border);border-radius:18px;padding:18px;text-align:center}
  .qrImg{max-width:86vw;max-height:70vh;border-radius:12px;border:1px solid rgba(255,255,255,.15);box-shadow:0 12px 36px rgba(0,0,0,.45)}

  /* Inventory stock bar adopts gcashRow styling */
  #stockBar{cursor:pointer}

  @media (max-width:560px){ .grid2{grid-template-columns:1fr} }
</style>
</head>
<body>
  <div class="wrap">
    <div class="title">LEGEND OF YMIR DIAMOND üíé</div>

    <div class="logoWrap">
      <div class="logo" id="secretLogo">
        <div class="ring"></div>
        <img src="logo.png" alt="Logo">
      </div>
    </div>

    <!-- Owner -->
    <div class="owner">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="#1877f2" aria-hidden="true">
        <path d="M22 12.07C22 6.48 17.52 2 11.93 2S2 6.48 2 12.07c0 5.01 3.66 9.17 8.44 9.93v-7.02H7.9v-2.91h2.54V9.41c0-2.5 1.49-3.89 3.77-3.89 1.09 0 2.24.2 2.24.2v2.46h-1.26c-1.24 0-1.63.77-1.63 1.56v1.87h2.78l-.44 2.91h-2.34V22c4.78-.76 8.44-4.92 8.44-9.93z"/>
      </svg>
      <a href="https://www.facebook.com/share/1FWLHh32iE/" target="_blank" rel="noopener">
        <span class="ownerName">MOISES TRAJANO BITONIO</span>
        <svg class="metaBadge" viewBox="0 0 24 24" aria-hidden="true">
          <defs><linearGradient id="g" x1="0" y1="0" x2="1" y2="1"><stop offset="0" stop-color="#2aa4ff"/><stop offset="1" stop-color="#1877f2"/></linearGradient></defs>
          <circle cx="12" cy="12" r="10" fill="url(#g)"/>
          <path d="M9.2 12.6l-1.7-1.7a1 1 0 10-1.4 1.4l2.4 2.4c.4.4 1 .4 1.4 0l6.1-6.1a1 1 0 10-1.4-1.4l-5.4 5.4z" fill="#fff"/>
        </svg>
      </a>
    </div>
   <!-- Tiers -->
    <div class="row prices">
      <div id="pill80" class="pill active">
        <div class="pval">‚Ç±0.80</div>
        <div class="ptxt">min 1000 üíé</div>
      </div>
      <div id="pill75" class="pill">
        <div class="pval">‚Ç±0.75</div>
        <div class="ptxt">min 4000 üíé</div>
      </div>
      <div id="pill70" class="pill best">
        <div class="pval">‚Ç±0.70</div>
        <div class="ptxt">min 8000 üíé</div>
        <div class="dealChip">üî• BEST DEAL</div>
      </div>
    </div>

    <!-- Inputs -->
    <div class="section">
      <div class="label">Enter Diamonds üíé</div>
      <input id="dias" class="in" inputmode="numeric" autocomplete="off" placeholder="e.g. 1500">

      <div class="label" style="margin-top:10px">ENTER PHP ‚Ç±</div>
      <input id="phpIn" class="in" inputmode="decimal" autocomplete="off" placeholder="e.g. 500.00">

      <div class="label" style="margin-top:10px">Server (Required)</div>
      <input id="serverIn" class="in" placeholder="Type exact server (e.g., ASIA-022 / HOF1)" autocomplete="off">
      <div class="hint">Make sure tama ang server name para iwas delay sa drop.</div>

      <div id="warn" class="warn">Minimum 1000 üíé required and Server is needed.</div>

      <div class="grid2">
        <div class="box">
          <h5>Rate</h5>
          <div id="rateOut" class="rateOut">0.80</div>
        </div>
        <div class="box saveBox">
          <h5>Save</h5>
          <div id="saveOut" class="saveOut">‚Äî</div>
        </div>
      </div>
    </div>

    <!-- Buy -->
    <button id="buyBtn" type="button" class="btn buy" disabled>üíé Buy</button>
    <div class="label" style="text-align:center;margin-top:8px">Enter at least 1000 dias, then type your server.</div>

    <!-- ========== INVENTORY (Total Stock + Manage) ========== -->
    <div id="stockBar" class="gcashRow" style="margin-top:14px;">
      <div class="gcashLeft">
        <span style="font-size:18px">üì¶</span>
        <strong style="letter-spacing:.3px">Total Stock:</strong>
        <span id="totalStock" style="margin-left:6px">‚Äî</span>
        <span style="margin-left:8px">üíé</span>
      </div>
      <button type="button" id="openInv" class="qrBtn">Manage</button>
    </div>

    <!-- Modal: Inventory manager -->
    <div id="invModal">
      <div class="cardPop" style="width:min(96vw,860px);text-align:left">
        <div style="display:flex;justify-content:space-between;align-items:center;gap:8px;margin-bottom:10px">
          <h3 style="margin:0">Ymir Inventory</h3>
          <div style="display:flex;gap:8px">
            <button id="btnExport" class="btn" style="background:#253126;color:#dfffe9">Export CSV</button>
            <label class="btn" style="background:#232329;color:#fff;cursor:pointer">
              Import CSV
              <input id="csvIn" type="file" accept=".csv" style="display:none">
            </label>
            <button id="btnCloseInv" class="btn" style="background:#272327;color:#fff">Close</button>
          </div>
        </div>

        <div class="hint" id="adminHint" style="margin:-4px 0 10px">
          üîí Read-only. Tap the stock bar <b>5√ó</b> para ma-unlock ang editing sa device na ‚Äôto.
        </div>

        <div style="overflow:auto;max-height:60vh;border:1px solid rgba(255,255,255,.12);border-radius:12px">
          <table id="invTable" style="width:100%;border-collapse:separate;border-spacing:0">
            <thead>
              <tr style="background:#15131a;position:sticky;top:0">
                <th style="padding:10px 12px;text-align:left">Server</th>
                <th style="padding:10px 12px;text-align:right">Qty üíé</th>
                <th style="padding:10px 12px;text-align:right">Price/1000 (USDT)</th>
                <th style="padding:10px 12px;text-align:right;width:160px">Actions</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>

        <div style="display:grid;grid-template-columns:1.2fr .6fr .6fr auto;gap:10px;margin-top:12px">
          <input id="fServer" class="in" placeholder="Server name (exact)">
          <input id="fQty" class="in" inputmode="numeric" placeholder="Qty e.g. 3000">
          <input id="fPrice" class="in" inputmode="decimal" placeholder="Price/1000 e.g. 11.5">
          <button id="btnSaveRow" class="btn" style="background:#21d072;color:#092112;font-weight:800">Add/Update</button>
        </div>

        <div style="display:grid;grid-template-columns:1fr .7fr auto;gap:10px;margin-top:12px">
          <input id="cServer" class="in" placeholder="Server to compute">
          <input id="cOrder" class="in" inputmode="numeric" placeholder="Order qty (diamonds)">
          <button id="btnCompute" class="btn" style="background:#204c2f;color:#e7fff1">Compute</button>
        </div>
        <div id="computeOut" class="hint" style="margin-top:8px">‚Äî</div>
      </div>
    </div>
    <!-- ========== /INVENTORY ========== -->

    <!-- Payment + Socials -->
    <div class="pay">
      <!-- GCash copy row -->
      <div id="gcashRow" class="gcashRow" title="Tap to copy number">
        <div class="gcashLeft">
          <div class="gcashIcon">G</div>
          GCash ‚Ä¢ <strong id="gcashNumber">09162466318 ‚Äî MOISES B.</strong>
        </div>
        <button id="showQR" type="button" class="qrBtn" title="Show GCash QR">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="#cfe4ff" aria-hidden="true">
            <path d="M3 3h8v8H3V3zm2 2v4h4V5H5zm6 6h8v8h-8v-8zm2 2v4h4v-4h-4zM3 13h8v8H3v-8zm2 2v4h4v-4H5zm12-12h4v4h-4V3z"/>
          </svg>
          Show QR
        </button>
      </div>

      <!-- GoTyme copy row -->
      <div id="goRow" class="gcashRow" title="Tap to copy account" style="background:rgba(0,214,231,.08);border-color:rgba(0,214,231,.35)">
        <div class="gcashLeft">
          <svg width="26" height="26" viewBox="0 0 32 32" aria-hidden="true"
               style="border-radius:999px; box-shadow:0 0 10px rgba(0,214,231,.35)">
            <defs>
              <linearGradient id="goTeal" x1="0" y1="0" x2="1" y2="1">
                <stop offset="0" stop-color="#00D6E7"/><stop offset="1" stop-color="#00BFD3"/>
              </linearGradient>
            </defs>
            <rect x="0" y="0" width="32" height="32" rx="16" fill="url(#goTeal)"/>
            <path d="M10.5 16a5.5 5.5 0 1 1 11 0 5.5 5.5 0 0 1-11 0zm2.6 0a2.9 2.9 0 1 0 5.8 0 2.9 2.9 0 0 0-5.8 0z" fill="#00353A" opacity=".95"/>
          </svg>
          GoTyme ‚Ä¢ <strong id="goNumber">014664932955 ‚Äî MOISES BITONIO</strong>
        </div>
        <button id="showGoQR" type="button" class="qrBtn" title="Show GoTyme QR" style="background:rgba(0,214,231,.14);border-color:rgba(0,214,231,.45);color:#d6fffe">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="#d6fffe" aria-hidden="true">
            <path d="M3 3h8v8H3V3zm2 2v4h4V5H5zm6 6h8v8h-8v-8zm2 2v4h4v-4h-4zM3 13h8v8H3v-8zm2 2v4h4v-4H5zm12-12h4v4h-4V3z"/>
          </svg>
          Show QR
        </button>
      </div>
     <div class="soc">
        <a class="btnlink fb" href="https://www.facebook.com/share/p/17MiaRJ24J/" target="_blank" rel="noopener">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="#fff" aria-hidden="true">
            <path d="M22 12.07C22 6.48 17.52 2 11.93 2S2 6.48 2 12.07c0 5.01 3.66 9.17 8.44 9.93v-7.02H7.9v-2.91h2.54V9.41c0-2.5 1.49-3.89 3.77-3.89 1.09 0 2.24.2 2.24.2v2.46 h-1.26c-1.24 0-1.63.77-1.63 1.56v1.87h2.78l-.44 2.91h-2.34V22c4.78-.76 8.44-4.92 8.44-9.93z"/>
          </svg>
          FACEBOOK FEEDBACK
        </a>
        <a class="btnlink dc" href="https://discord.gg/QkdVz5mh" target="_blank" rel="noopener">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="#fff" aria-hidden="true">
            <path d="M20.3 4.4A16 16 0 0015.9 3l-.4.8a13.3 13.3 0 00-7 0L8.1 3A16 16 0 003.7 4.4C1.7 7.5 1 10.5 1.2 13.4a16 16 0 005.9 3l.8-1.3c-.4-.1-.7-.3-1-.4.1-.1.2-.2.3-.3 1.9.9 4 .9 5.9 0l.3.3c-.3.2-.6.3-1 .4l.8 1.3a16 16 0 005.9-3c.3-3-.5-5.9-2.8-9zM9.6 13c-.9 0-1.6-.8-1.6-1.7S8.7 9.6 9.6 9.6s1.6.8 1.6 1.7S10.5 13 9.6 13zm4.8 0c-.9 0-1.6-.8-1.6-1.7s.7-1.7 1.6-1.7 1.6.8 1.6 1.7-.7 1.7-1.6 1.7z"/>
          </svg>
          DISCORD FEEDBACK
        </a>
      </div>
    </div>

    <!-- Waiting Time Notice -->
    <div class="notice">
      <h4>‚è≥ Waiting Time Notice</h4>
      <p>Processing time may vary depending on server demand. Some servers might experience longer wait times ‚Äî pero <strong>guaranteed matatanggap ang order mo</strong>.</p>
    </div>

    <!-- Track Order -->
    <div class="track">
      <div class="label" style="margin-bottom:6px">Track Order</div>
      <div style="display:grid;grid-template-columns:1fr auto;gap:10px">
        <input id="trackIn" class="in" placeholder="Enter Receipt ID (e.g., YMIR-XXXX)" autocomplete="off">
        <button id="trackBtn" class="btn" style="background:#27252c;color:#fff">Check</button>
      </div>
      <div id="trackOut" style="margin-top:10px;display:none">
        <div class="chip" style="margin-bottom:8px">
          <strong id="t_id">‚Äî</strong>
          <span id="t_status" style="opacity:.9"></span>
        </div>
        <div style="display:grid;gap:6px;font-size:14px;color:#ccb9c1">
          <div>Server: <span id="t_server" style="color:#fff"></span></div>
          <div>Diamonds: <span id="t_qty" style="color:#fff"></span> üíé</div>
          <div>Rate: <span id="t_rate" style="color:#fff"></span></div>
          <div>Total: <span id="t_total" style="color:#fff"></span></div>
          <div>Created: <span id="t_time" style="color:#fff"></span></div>
        </div>
        <div style="display:flex;gap:8px;margin-top:10px;flex-wrap:wrap">
          <button id="btnPaid" class="btn" style="background:#204c2f;color:#e7fff1">Buyer: I Paid</button>
          <!-- Delivered is secret: 6 taps on the logo -->
        </div>
        <div class="hint" style="margin-top:6px">
          Tip: Buyer taps <b>I Paid</b> after sending payment. (Local tracking only)
        </div>
      </div>
      <div id="trackNone" class="hint" style="display:none;margin-top:8px">Walang record sa device na ‚Äôto. Note: Tracking works on the same phone/browser (local only).</div>
    </div>
  </div>

  <!-- BUY Popup -->
  <div id="buyPopup">
    <div class="cardPop">
      <h3>Copied ‚úî</h3>
      <p id="buyMsg"><strong>I-PASTE MO ITO SA MESSENGER KO.</strong><br>Open Messenger then paste the order message.</p>
      <div id="buyOrderId" style="margin:10px 0 6px;font-weight:800"></div>
      <button id="closePop" class="btn" style="background:#272327;color:#fff;width:160px;margin:auto">OK</button>
    </div>
  </div>

  <!-- GCash Copied Popup -->
  <div id="gcashPopup">
    <div class="cardPop">
      <h3>GCash number copied ‚úî</h3>
      <p><strong>09162466318 ‚Äî MOISES B.</strong><br>Paste sa GCash Express Send.</p>
      <button id="gcashOk" class="btn" style="background:#272327;color:#fff;width:160px;margin:auto">OK</button>
    </div>
  </div>

  <!-- QR Popups -->
  <div id="qrPopup"><div class="cardPop"><img src="gcash-qr.png" class="qrImg" alt="GCash QR"><div style="margin-top:10px"><button class="btn" id="qrClose" style="background:#272327;color:#fff">Close</button></div></div></div>
  <div id="goQRPopup"><div class="cardPop"><img src="gotyme-qr.png" class="qrImg" alt="GoTyme QR"><div style="margin-top:10px"><button class="btn" id="goQrClose" style="background:#272327;color:#fff">Close</button></div></div></div>

<script>
(() => {
  /* ====== Helper ====== */
  const $ = s => document.querySelector(s);
  const money = n => Number(n||0).toLocaleString(undefined,{minimumFractionDigits:2,maximumFractionDigits:2});
  const clamp = (v,min,max)=>Math.max(min,Math.min(max,v));

  /* ====== Tier selection & simple calc ====== */
  const pills = [$("#pill80"), $("#pill75"), $("#pill70")];
  let rate = 0.80;
  function setActive(i){
    pills.forEach((p,idx)=>p.classList.toggle("active", idx===i));
    rate = i===0?0.80 : i===1?0.75 : 0.70;
    $("#rateOut").textContent = rate.toFixed(2);
    updateSave();
    validateBuy();
  }
  pills[0].addEventListener("click",()=>setActive(0));
  pills[1].addEventListener("click",()=>setActive(1));
  pills[2].addEventListener("click",()=>setActive(2));

  function updateSave(){
    const php = parseFloat($("#phpIn").value||"0");
    const dias = parseInt($("#dias").value||"0",10);
    if(!dias || !php){ $("#saveOut").textContent = "‚Äî"; return; }
    const nominal = dias * rate; // simpleng proxy; adjust if you have real save logic
    const save = clamp(nominal - php, -999999, 999999);
    $("#saveOut").textContent = (save>=0?"+":"") + money(save);
  }

  ["#phpIn","#dias"].forEach(id => $(id).addEventListener("input", ()=>{updateSave(); validateBuy();}));

  function validateBuy(){
    const dias = parseInt($("#dias").value||"0",10);
    const server = $("#serverIn").value.trim();
    const ok = dias>=1000 && server.length>0;
    $("#warn").style.display = ok? "none":"block";
    $("#buyBtn").disabled = !ok;
  }

  /* ====== Buy ‚Üí copy order message + local track ====== */
  const LS_ORDERS = "ymir_local_orders_v1";
  function loadOrders(){ try{return JSON.parse(localStorage.getItem(LS_ORDERS)||"[]")}catch{return[]} }
  function saveOrders(arr){ localStorage.setItem(LS_ORDERS, JSON.stringify(arr)); }

  function newId(){ return "YMIR-" + Math.random().toString(36).slice(2,6).toUpperCase(); }

  $("#buyBtn").addEventListener("click", async ()=>{
    const dias = parseInt($("#dias").value,10);
    const php  = parseFloat($("#phpIn").value||"0");
    const server = $("#serverIn").value.trim();
    const id = newId();
    const msg =
`ORDER: LEGEND OF YMIR üíé
Receipt: ${id}
Diamonds: ${dias.toLocaleString()} üíé
Rate: ‚Ç±${rate.toFixed(2)}
Est. PHP: ‚Ç±${money(dias*rate)}
Server: ${server}

GCash: 09162466318 (MOISES B.)`;
    try{
      await navigator.clipboard.writeText(msg);
    }catch(e){}
    // store local order
    const orders = loadOrders();
    orders.unshift({
      id, dias, rate, server,
      total: +(dias*rate).toFixed(2),
      status:"Pending", time: new Date().toISOString()
    });
    saveOrders(orders);

    $("#buyOrderId").textContent = id;
    $("#buyPopup").style.display = "grid";
  });

  $("#closePop").addEventListener("click", ()=>$("#buyPopup").style.display="none");

  /* ====== Payments & QR ====== */
  function tapCopy(elId, popupId){
    const text = $(elId).textContent;
    $("#"+popupId).style.display = "grid";
    navigator.clipboard?.writeText(text).catch(()=>{});
  }
  $("#gcashRow").addEventListener("click", ()=> tapCopy("gcashNumber","gcashPopup"));
  $("#gcashOk").addEventListener("click", ()=> $("#gcashPopup").style.display="none");
  $("#showQR").addEventListener("click", ()=> $("#qrPopup").style.display="grid");
  $("#qrClose").addEventListener("click", ()=> $("#qrPopup").style.display="none");

  $("#goRow").addEventListener("click", ()=> tapCopy("goNumber","gcashPopup"));
  $("#showGoQR").addEventListener("click", ()=> $("#goQRPopup").style.display="grid");
  $("#goQrClose").addEventListener("click", ()=> $("#goQRPopup").style.display="none");

  /* ====== Tracking (local) ====== */
  $("#trackBtn").addEventListener("click", ()=>{
    const id = $("#trackIn").value.trim().toUpperCase();
    const orders = loadOrders();
    const found = orders.find(o=>o.id===id);
    if(!found){ $("#trackOut").style.display="none"; $("#trackNone").style.display="block"; return; }
    $("#trackNone").style.display="none";
    $("#trackOut").style.display="block";
    $("#t_id").textContent = found.id;
    $("#t_status").textContent = found.status;
    $("#t_server").textContent = found.server;
    $("#t_qty").textContent = found.dias.toLocaleString();
    $("#t_rate").textContent = "‚Ç±"+found.rate.toFixed(2);
    $("#t_total").textContent = "‚Ç±"+money(found.total);
    $("#t_time").textContent = new Date(found.time).toLocaleString();
  });

  $("#btnPaid").addEventListener("click", ()=>{
    const id = $("#t_id").textContent.trim();
    if(!id) return;
    const arr = loadOrders();
    const i = arr.findIndex(o=>o.id===id);
    if(i>=0){ arr[i].status="Buyer Paid"; saveOrders(arr); $("#t_status").textContent="Buyer Paid"; }
  });

  /* ====== Inventory Manager (localStorage + CSV) ====== */
  const KEY = "ymir_inventory_v1";
  const ADMIN_KEY = "ymir_admin_unlocked";
  const DEFAULT = [
    ["HOF1", null, null], ["DaddyKin", 3000, 11.5], ["Tokyo", 15400, 9.5],
    ["HOF2", 2040, 11.5], ["DaddyVerse", 4912, 11.5], ["Kings", 6440, 11.5],
    ["HOF3", 1000, 11.5], ["DaddyWorlde", null, null], ["Á†¥ÂÜõ", null, null],
    ["ManiTW", 9000, 9.0], ["ISEKAI", 35000, 11.0], ["8888", null, null],
    ["Bangkok", 1286, 12.0], ["PROSGARD", 900, 11.0], ["X", 3900, 11.5],
    ["Chess", 7444, 11.5], ["XAOU", 14269, 9.0],
    ["ASIA014", null, null], ["ASIA015", 3000, 12.0], ["ASIA016", 9000, 11.5],
    ["ASIA017", 3200, 11.0], ["ASIA018", 4500, 11.0], ["ASIA019", null, null],
    ["ASIA020", 3000, 9.5], ["ASIA021", 1500, 11.5], ["ASIA022", null, null],
    ["ASIA023", 2000, 11.5], ["ASIA024", 1400, 10.0], ["ASIA025", 3000, 12.0],
    ["ASIA026", null, null], ["ASIA027", 1500, 10.5], ["ASIA028", 9300, 10.5],
    ["ASIA029", null, null], ["ASIA030", null, null], ["ASIA031", null, null],
  ];
  const totalStock = $("#totalStock");
  const invModal = $("#invModal"), tbody=$("#invTable tbody");
  const fServer=$("#fServer"), fQty=$("#fQty"), fPrice=$("#fPrice");
  const cServer=$("#cServer"), cOrder=$("#cOrder"), computeOut=$("#computeOut");
  const adminHint=$("#adminHint");

  function fmt(v){ return (v==null||Number.isNaN(v)) ? "Ôºè" : (typeof v==="number" ? (Math.round(v*10000)/10000).toString().replace(/\.0+$/,"") : String(v)); }
  function loadInv(){
    const raw = localStorage.getItem(KEY);
    if(!raw) return DEFAULT.map(([s,q,p])=>({server:s,qty:q,price:p}));
    try{
      const arr = JSON.parse(raw);
      return arr.map(r=>({server:String(r.server||"").trim(), qty:r.qty==null?null:Number(r.qty), price:r.price==null?null:Number(r.price)})).filter(r=>r.server);
    }catch{return DEFAULT.map(([s,q,p])=>({server:s,qty:q,price:p}))}
  }
  function saveInv(rows){ localStorage.setItem(KEY, JSON.stringify(rows)); updateTotal(rows); }

  let rows = loadInv();
  let admin = localStorage.getItem(ADMIN_KEY)==="1";

  function updateTotal(list){
    const sum = list.reduce((a,r)=>a+(Number.isFinite(r.qty)?r.qty:0),0);
    totalStock.textContent = sum.toLocaleString();
  }

  function renderInv(){
    tbody.innerHTML="";
    rows.slice().sort((a,b)=>a.server.localeCompare(b.server)).forEach((r,i)=>{
      const tr=document.createElement("tr");
      tr.innerHTML = `
        <td style="padding:10px 12px;border-top:1px solid rgba(255,255,255,.07)">${r.server}</td>
        <td style="padding:10px 12px;border-top:1px solid rgba(255,255,255,.07);text-align:right">${fmt(r.qty)}</td>
        <td style="padding:10px 12px;border-top:1px solid rgba(255,255,255,.07);text-align:right">${fmt(r.price)}</td>
        <td style="padding:10px 12px;border-top:1px solid rgba(255,255,255,.07);text-align:right">
          <button class="btn btnEdit" data-i="${i}" style="background:#233;color:#fff;margin-right:6px" ${admin?"":"disabled"}>Edit</button>
          <button class="btn btnDel"  data-i="${i}" style="background:#3a1c22;color:#ffdce1" ${admin?"":"disabled"}>Delete</button>
        </td>`;
      tbody.appendChild(tr);
    });
    tbody.querySelectorAll(".btnEdit").forEach(b=>b.addEventListener("click",e=>{
      if(!admin) return;
      const i=+e.currentTarget.dataset.i;
      fServer.value=rows[i].server; fQty.value=rows[i].qty??""; fPrice.value=rows[i].price??""; fServer.focus();
    }));
    tbody.querySelectorAll(".btnDel").forEach(b=>b.addEventListener("click",e=>{
      if(!admin) return;
      const i=+e.currentTarget.dataset.i;
      if(confirm(`Delete '${rows[i].server}'?`)){ rows.splice(i,1); saveInv(rows); renderInv(); }
    }));
    adminHint.style.display = admin? "none":"block";
  }

  $("#openInv").addEventListener("click", ()=> invModal.style.display="grid");
  $("#btnCloseInv").addEventListener("click", ()=> invModal.style.display="none");

  // 5-tap unlock on stock bar
  (function(){
    const bar=$("#stockBar"); let taps=0, t=null;
    bar.addEventListener("click", ()=>{
      taps++; clearTimeout(t); t=setTimeout(()=>taps=0,650);
      if(taps>=5){ admin=true; localStorage.setItem(ADMIN_KEY,"1"); renderInv(); taps=0; }
    });
  })();

  $("#btnSaveRow").addEventListener("click", ()=>{
    if(!admin) return;
    const name=fServer.value.trim(); if(!name) return alert("Server name is required.");
    const qty = fQty.value.trim()===""?null:Number(fQty.value.replace(/,/g,""));
    const price = fPrice.value.trim()===""?null:Number(fPrice.value);
    const idx = rows.findIndex(r=>r.server.toLowerCase()===name.toLowerCase());
    if(idx<0) rows.push({server:name, qty:Number.isFinite(qty)?qty:null, price:Number.isFinite(price)?price:null});
    else {
      if(fQty.value.trim()!=="") rows[idx].qty=Number.isFinite(qty)?qty:null;
      if(fPrice.value.trim()!=="") rows[idx].price=Number.isFinite(price)?price:null;
    }
    saveInv(rows); renderInv(); fServer.value=fQty.value=fPrice.value="";
  });

  $("#btnCompute").addEventListener("click", ()=>{
    const name=cServer.value.trim();
    const order=Number(cOrder.value.replace(/,/g,""));
    const r=rows.find(x=>x.server.toLowerCase()===name.toLowerCase());
    if(!r){ computeOut.textContent="Server not found."; return; }
    if(r.price==null){ computeOut.textContent="Missing price for this server."; return; }
    if(!Number.isFinite(order)||order<=0){ computeOut.textContent="Invalid order qty."; return; }
    const total = Math.round(((order/1000)*r.price)*100)/100;
    computeOut.textContent = `Price/1000: ${r.price} USDT ‚Ä¢ Qty: ${order.toLocaleString()} üíé ‚Üí TOTAL: ${total} USDT`;
  });

  $("#btnExport").addEventListener("click", ()=>{
    const header="server,qty,price_per_1000_usdt\n";
    const body = rows.map(r=>[r.server.replaceAll(","," "), r.qty??"", r.price??""].join(",")).join("\n");
    const blob=new Blob([header+body],{type:"text/csv;charset=utf-8"});
    const url=URL.createObjectURL(blob);
    const a=document.createElement("a"); a.href=url; a.download="ymir_inventory.csv"; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
  });

  $("#csvIn").addEventListener("change", async e=>{
    const f=e.target.files?.[0]; if(!f) return;
    const text=await f.text(); const lines=text.trim().split(/\r?\n/); const out=[];
    let i=0; if(/server\s*,\s*qty\s*,\s*price/i.test(lines[0])) i=1;
    for(; i<lines.length; i++){
      const [s,q,p]=lines[i].split(",");
      const server=(s||"").trim(); if(!server) continue;
      const qty=(q||"").trim()===""?null:Number(q);
      const price=(p||"").trim()===""?null:Number(p);
      out.push({server, qty:Number.isFinite(qty)?qty:null, price:Number.isFinite(price)?price:null});
    }
    rows=out; saveInv(rows); renderInv(); e.target.value="";
  });

  // Initial
  renderInv(); updateTotal(rows);

  // ====== Secret "Delivered" ‚Üí auto-deduct (6 taps on logo) ======
  const logo = document.getElementById("secretLogo");
  let ltaps=0, lt=null;
  logo?.addEventListener("click", ()=>{
    ltaps++; clearTimeout(lt); lt=setTimeout(()=>ltaps=0,700);
    if(ltaps>=6){
      const server = (document.getElementById("t_server")?.textContent||"").trim();
      const qty = Number((document.getElementById("t_qty")?.textContent||"").replace(/[^\d]/g,""));
      if(server && Number.isFinite(qty) && qty>0){
        const i = rows.findIndex(r=>r.server.toLowerCase()===server.toLowerCase());
        if(i>=0){
          if(!Number.isFinite(rows[i].qty)) rows[i].qty=0;
          rows[i].qty = Math.max(0, rows[i].qty - qty);
          saveInv(rows); renderInv();
          const sEl=document.getElementById("t_status"); if(sEl) sEl.textContent="Delivered";
          alert(`Delivered ‚úì\n${qty.toLocaleString()} üíé deducted from ${server}.`);
        }
      }
      ltaps=0;
    }
  });
})();
</script>
</body>
</html>
