<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>LEGEND OF YMIR DIAMOND üíé ‚Äî Sell + Stock v2</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
  :root{--txt:#fff7fb;--mut:#ccb9c1;--mut2:#a8989f;--green:#21d072;--blue:#1877f2;--discord:#5865f2;--red1:#1a0f14;--red2:#120a10;--ink:#09060a;--border:rgba(255,100,140,.18);--ring:conic-gradient(#ff2b63,#ff6ea0,#ff2b63);--glow-soft:0 0 16px rgba(255,40,100,.22);--chip:#222027}
  *{box-sizing:border-box}
  html,body{margin:0;color:var(--txt);font-family:Poppins,system-ui,Segoe UI,Roboto,Arial,sans-serif;background:var(--ink);min-height:100%}
  body::before{content:"";position:fixed;inset:-20% -20%;z-index:-3;pointer-events:none;background:radial-gradient(40% 30% at 15% 10%, rgba(255,40,100,.14), transparent 60%),radial-gradient(38% 28% at 85% 5%, rgba(200,20,80,.10), transparent 65%),radial-gradient(55% 40% at 50% 110%, rgba(255,30,100,.10), transparent 72%);filter:blur(10px) saturate(112%);animation:bgFloat 16s ease-in-out infinite alternate}
  @keyframes bgFloat{0%{transform:translate3d(0,0,0)}100%{transform:translate3d(1.2%,-1.2%,0)}}
  body::after{content:"";position:fixed;inset:0;z-index:-2;pointer-events:none;opacity:.45;background:radial-gradient(circle at 18% 28%, rgba(255,80,130,.25) 0 1px, transparent 2px),radial-gradient(circle at 78% 18%, rgba(255,60,110,.22) 0 1px, transparent 2px),radial-gradient(circle at 68% 78%, rgba(255,50,100,.20) 0 1px, transparent 2px),radial-gradient(circle at 28% 82%, rgba(255,70,120,.18) 0 1px, transparent 2px);animation:spark 11s linear infinite}
  @keyframes spark{0%{transform:translateY(0)}100%{transform:translateY(-8px)}}
  .wrap{max-width:760px;margin:auto;padding:16px 14px 120px}
  .title{display:flex;gap:10px;justify-content:center;font-weight:800;font-size:22px;letter-spacing:.4px;margin:2px 0 8px;text-shadow:0 0 10px rgba(255,70,120,.25)}
  .logoWrap{display:grid;place-items:center;margin:6px 0 8px}
  .logo{width:min(44vw,186px);aspect-ratio:1/1;border-radius:999px;position:relative;display:grid;place-items:center;background:radial-gradient(120px 110px at 50% 50%, #0e0a0d 40%, #000 100%);box-shadow:0 0 0 8px rgba(0,0,0,.55);cursor:pointer}
  .ring{position:absolute;inset:10px;border-radius:999px;background:var(--ring);filter:blur(.55px);-webkit-mask:radial-gradient(circle, transparent 61.5%, #000 63%);mask:radial-gradient(circle, transparent 61.5%, #000 63%);animation:spin 9s linear infinite;opacity:.55}
  @keyframes spin{to{transform:rotate(360deg)}}
  .logo img{width:82%;border-radius:999px;box-shadow:0 0 18px rgba(255,40,100,.28)}
  .owner{margin:10px auto 8px;display:flex;gap:10px;align-items:center;justify-content:center;padding:10px 12px;border-radius:14px;background:linear-gradient(180deg,#131218,#0d0c12);border:1px solid rgba(255,255,255,.10);box-shadow:0 0 16px rgba(0,0,0,.25);font-weight:800;max-width:560px}
  .owner a{color:#fff;text-decoration:none;display:inline-flex;align-items:center;gap:8px}
  .ownerName{letter-spacing:.3px}
  .metaBadge{width:22px;height:22px;display:inline-block;filter:drop-shadow(0 0 10px rgba(24,119,242,.45))}
  .row{display:grid;gap:12px}
  .prices{display:grid;grid-template-columns:repeat(3,1fr);margin:6px 0 10px}
  .pill{position:relative;background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,.00));border:1px solid var(--border);border-radius:18px;padding:12px;text-align:center;box-shadow:inset 0 0 0 1px rgba(255,30,80,.06), var(--glow-soft);transition:transform .18s, box-shadow .18s, border-color .18s, opacity .18s}
  .pval{font-size:26px;font-weight:900}
  .ptxt{font-size:12px;color:#ccb9c1}
  .pill.active{transform:translateY(-2px) scale(1.02);border-color:rgba(80,255,170,.55);box-shadow:0 0 20px rgba(40,255,170,.26), inset 0 0 0 1px rgba(40,255,170,.28)}
  .pill.lock{opacity:.55;filter:grayscale(.25);border-color:rgba(255,255,255,.10);box-shadow:none}
  .pill.flame{border-color:rgba(255,120,0,.7)!important;box-shadow:0 0 24px rgba(255,120,0,.35),0 0 42px rgba(255,60,0,.25),inset 0 0 0 1px rgba(255,150,80,.35);animation:flamePulse 1.2s ease-in-out infinite}
  .pill.flame::before,.pill.flame::after{content:"";position:absolute;left:50%;transform:translateX(-50%);width:64%;height:46%;bottom:-8px;border-radius:50% 50% 40% 40%;filter:blur(8px) drop-shadow(0 0 12px rgba(255,120,0,.55));pointer-events:none}
  .pill.flame::before{background:radial-gradient(60% 70% at 50% 80%,rgba(255,180,60,.9) 0%,rgba(255,110,30,.75) 35%,rgba(255,60,0,.55) 60%,rgba(255,60,0,0) 72%);animation:flameFlicker 180ms infinite steps(2,end)}
  .pill.flame::after{background:radial-gradient(55% 65% at 50% 78%,rgba(255,240,200,.85) 0%,rgba(255,170,80,.65) 35%,rgba(255,90,0,.45) 60%,rgba(255,90,0,0) 72%);opacity:.9;mix-blend-mode:screen;animation:flameRise 1.6s ease-in-out infinite}
  @keyframes flamePulse{0%,100%{transform:translateY(0)}50%{transform:translateY(-1px)}}@keyframes flameFlicker{50%{filter:blur(10px) drop-shadow(0 0 16px rgba(255,140,0,.65))}}@keyframes flameRise{0%{transform:translateX(-50%) translateY(0) scale(1);opacity:.85}50%{transform:translateX(-50%) translateY(-2px) scale(1.04);opacity:.95}100%{transform:translateX(-50%) translateY(0) scale(1);opacity:.85}}
  .dealChip{position:absolute;top:-10px;right:-10px;background:linear-gradient(180deg,#ffb66a,#ff7b2c);color:#2b1200;font-weight:900;font-size:11px;padding:6px 8px;border-radius:999px;box-shadow:0 8px 22px rgba(255,120,0,.35);border:1px solid rgba(255,255,255,.35);display:flex;align-items:center;gap:6px;transform:scale(.9);opacity:0;pointer-events:none;transition:opacity .18s ease,transform .18s ease}
  .pill.best .dealChip{opacity:1;transform:scale(1)}
  .section{background:linear-gradient(180deg,var(--red1),var(--red2));border:1px solid var(--border);border-radius:18px;padding:14px;box-shadow:var(--glow-soft)}
  .label{font-size:13px;color:#ccb9c1;margin:4px 2px 6px}
  .in{width:100%;border:1px solid rgba(255,120,160,.20);background:#0b090c;color:#fff;padding:14px;border-radius:14px;font-size:18px;outline:none;box-shadow:inset 0 0 14px rgba(255,20,80,.06), 0 0 12px rgba(255,40,100,.12)}
  .in:focus{border-color:#ff6aa1;box-shadow:0 0 0 3px rgba(255,60,110,.16), var(--glow-soft)}
  .hint{font-size:12px;color:#a8989f;margin-top:6px}
  .warn{margin-top:8px;font-size:12px;color:#ff7b94;display:none}
  .grid2{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:10px}
  .box{background:linear-gradient(180deg,#1a1218,#120e13);border:1px solid rgba(255,120,160,.18);border-radius:16px;padding:12px;text-align:center;box-shadow:var(--glow-soft)}
  .box h5{margin:0 0 4px;font-size:12px;color:#ccb9c1}
  .rateOut{font-weight:900;font-size:20px}
  .saveOut{font-weight:900;font-size:20px;color:#baffd6}
  .saveBox{background:linear-gradient(180deg,#0f2117,#0a1a11);border-color:rgba(40,255,160,.24)}
  .btn{display:inline-flex;align-items:center;justify-content:center;gap:10px;border:none;border-radius:14px;padding:14px 16px;font-weight:800;letter-spacing:.2px;cursor:pointer;user-select:none}
  .buy{background:linear-gradient(180deg,#ffd39e,#ffb45a);color:#2b1200;font-size:18px;box-shadow:0 18px 44px rgba(255,160,80,.24), inset 0 -6px 0 rgba(0,0,0,.12);width:100%;margin-top:10px;transition:transform .12s}
  .buy:active{transform:translateY(1px)}
  .btn[disabled]{opacity:.55;filter:grayscale(.25);cursor:not-allowed}
  .pay{background:linear-gradient(180deg,#11111a,#0b0c12);border:1px solid rgba(24,119,242,.18);border-radius:18px;padding:12px 14px;box-shadow:0 0 18px rgba(24,119,242,.12);margin-top:10px}
  .gcashRow{display:flex;align-items:center;gap:12px;justify-content:space-between;background:rgba(24,119,242,.08);border:1px solid rgba(24,119,242,.28);padding:10px 12px;border-radius:12px;max-width:560px;margin:8px auto 10px;box-shadow:0 10px 24px rgba(24,119,242,.10);font-weight:800;cursor:pointer}
  .gcashLeft{display:flex;align-items:center;gap:10px}
  .gcashIcon{width:26px;height:26px;border-radius:999px;background:#1877f2;display:grid;place-items:center;box-shadow:0 0 10px rgba(24,119,242,.35), inset 0 0 8px rgba(255,255,255,.14);font-weight:900;color:#fff;letter-spacing:.2px;user-select:none}
  .qrBtn{display:inline-flex;align-items:center;gap:8px;background:rgba(24,119,242,.14);color:#eaf3ff;border:1px solid rgba(24,119,242,.38);padding:8px 12px;border-radius:10px;font-weight:800}
  .qrBtn svg{filter:drop-shadow(0 0 6px rgba(24,119,242,.42))}
  .soc{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:10px}
  .btnlink{display:inline-flex;align-items:center;justify-content:center;gap:10px;border-radius:14px;padding:14px 16px;font-weight:800;letter-spacing:.2px;text-decoration:none}
  .fb{background:var(--blue);color:#fff}
  .dc{background:var(--discord);color:#fff}
  .notice{margin-top:12px;padding:12px 14px;border-radius:14px;background:linear-gradient(180deg,#17141a,#120f14);border:1px solid rgba(255,255,255,.12);box-shadow:0 0 16px rgba(0,0,0,.25)}
  .notice h4{margin:0 0 6px;font-size:14px}
  .notice p{margin:0;color:#ccb9c1;font-size:13px}
  .track{margin-top:14px;background:linear-gradient(180deg,#151218,#100f13);border:1px solid rgba(255,255,255,.10);border-radius:14px;padding:14px;box-shadow:0 0 16px rgba(0,0,0,.25)}
  .chip{display:inline-flex;gap:8px;align-items:center;background:var(--chip);border:1px solid rgba(255,255,255,.08);padding:8px 12px;border-radius:12px}
  #buyPopup,#gcashPopup,#qrPopup,#goPopup,#goQRPopup,#stockPopup,#massPopup,#stockViewPopup{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;place-items:center;z-index:50}
  .cardPop{width:min(92vw,560px);background:#0f0d10;border:1px solid var(--border);border-radius:18px;padding:18px;text-align:center}
  .qrImg{max-width:86vw;max-height:70vh;border-radius:12px;border:1px solid rgba(255,255,255,.15);box-shadow:0 12px 36px rgba(0,0,0,.45)}
  @media (max-width:560px){.grid2{grid-template-columns:1fr}}
  /* STOCK styles */
  .stockHead{display:flex;align-items:center;justify-content:space-between;gap:10px;margin-bottom:10px}
  .miniBtn{padding:8px 10px;border-radius:10px;border:1px solid rgba(255,255,255,.18);background:#141116;color:#fff;font-weight:700;cursor:pointer}
  table.stock{width:100%;border-collapse:collapse}
  .stock th,.stock td{border-bottom:1px dashed rgba(255,255,255,.12);padding:10px 8px;text-align:center}
  .stock th{color:#ffb6cc;font-size:12px}
  td[contenteditable="true"]{outline:2px dashed transparent}
  td[contenteditable="true"]:focus{outline-color:#ff6aa1}
  .avail{font-size:12px;color:#b0ffa6;margin-top:6px}
  .thumb{width:44px;height:44px;border-radius:8px;border:1px solid rgba(255,255,255,.14);object-fit:cover}
</style>
</head>
<body>
  <div class="wrap">
    <div class="title">LEGEND OF YMIR DIAMOND üíé</div>
    <div class="logoWrap"><div class="logo" id="secretLogo"><div class="ring"></div><img src="logo.png" alt="Logo"></div></div>
    <div class="owner"><svg width="18" height="18" viewBox="0 0 24 24" fill="#1877f2" aria-hidden="true"><path d="M22 12.07C22 6.48 17.52 2 11.93 2S2 6.48 2 12.07c0 5.01 3.66 9.17 8.44 9.93v-7.02H7.9v-2.91h2.54V9.41c0-2.5 1.49-3.89 3.77-3.89 1.09 0 2.24.2 2.24.2v2.46h-1.26c-1.24 0-1.63.77-1.63 1.56v1.87h2.78l-.44 2.91h-2.34V22c4.78-.76 8.44-4.92 8.44-9.93z"/></svg><a href="https://www.facebook.com/share/1FWLHh32iE/" target="_blank" rel="noopener"><span class="ownerName">MOISES TRAJANO BITONIO</span><svg class="metaBadge" viewBox="0 0 24 24" aria-hidden="true"><defs><linearGradient id="g" x1="0" y1="0" x2="1" y2="1"><stop offset="0" stop-color="#2aa4ff"/><stop offset="1" stop-color="#1877f2"/></linearGradient></defs><circle cx="12" cy="12" r="10" fill="url(#g)"/><path d="M9.2 12.6l-1.7-1.7a1 1 0 10-1.4 1.4l2.4 2.4c.4.4 1 .4 1.4 0l6.1-6.1a1 1 0 10-1.4-1.4l-5.4 5.4z" fill="#fff"/></svg></a></div>

    <div class="row prices">
      <div id="pill80" class="pill"><div class="pval">‚Ç±0.80</div><div class="ptxt">min 1000 üíé</div></div>
      <div id="pill75" class="pill"><div class="pval">‚Ç±0.75</div><div class="ptxt">min 4000 üíé</div></div>
      <div id="pill70" class="pill"><div class="pval">‚Ç±0.70</div><div class="ptxt">min 8000 üíé</div><div class="dealChip" aria-hidden="true">üî• BEST DEAL</div></div>
    </div>

    <div class="section">
      <div class="label">Enter Diamonds üíé</div>
      <input id="dias" class="in" inputmode="numeric" autocomplete="off" placeholder="e.g. 1500">
      <div class="label" style="margin-top:10px">ENTER PHP ‚Ç±</div>
      <input id="phpIn" class="in" inputmode="decimal" autocomplete="off" placeholder="e.g. 500.00">
      <div class="label" style="margin-top:10px">Server (Required)</div>
      <input id="serverIn" class="in" placeholder="Type exact server (e.g., ASIA-022 / HOF1)" autocomplete="off" list="serverList">
      <datalist id="serverList"></datalist>
      <div id="availNote" class="avail" style="display:none">‚Äî</div>
      <div class="hint">Make sure tama ang server name para iwas delay sa drop.</div>
      <div id="warn" class="warn">Minimum 1000 üíé required, Server is needed, and order must not exceed stock.</div>
      <div class="grid2"><div class="box"><h5>Rate</h5><div id="rateOut" class="rateOut">‚Äî</div></div><div class="box saveBox"><h5>Save</h5><div id="saveOut" class="saveOut">‚Äî</div></div></div>
    </div>

    <!-- CHANGED BUTTON LABEL + ACTION -->
    <button id="buyBtn" type="button" class="btn buy" disabled>üìù Copy format for your order</button>
    <div class="label" style="text-align:center;margin-top:8px">Enter at least 1000 dias, then type your server.</div>

    <!-- STOCK INVENTORY (Editable) -->
    <div class="section" style="margin-top:12px">
      <div class="stockHead">
        <div class="label" style="margin:0">üì¶ Stock Inventory (editable, saved locally)</div>
        <div style="display:flex;gap:8px;flex-wrap:wrap">
          <button id="sAdd" class="miniBtn">+ Row</button>
          <button id="sSave" class="miniBtn">Save</button>
          <button id="sReset" class="miniBtn">Reset</button>
          <button id="sCSV" class="miniBtn">Export CSV</button>
          <button id="sPop" class="miniBtn">Open Stock Popup</button>
          <button id="sMass" class="miniBtn">Mass Update</button>
        </div>
      </div>
      <table class="stock">
        <thead><tr><th>Pic</th><th>Server</th><th>Qty</th><th>Notes</th><th></th></tr></thead>
        <tbody id="stockBody"></tbody>
      </table>
      <div class="hint">Tip: click the picture/row to view or change image. Kapag Delivered, auto bawas sa stock.</div>
    </div>

    <div class="pay">
      <div id="gcashRow" class="gcashRow" title="Tap to copy number"><div class="gcashLeft"><div class="gcashIcon">G</div>GCash ‚Ä¢ <strong id="gcashNumber">09162466318 ‚Äî MOISES B.</strong></div><button id="showQR" type="button" class="qrBtn" title="Show GCash QR"><svg width="18" height="18" viewBox="0 0 24 24" fill="#cfe4ff" aria-hidden="true"><path d="M3 3h8v8H3V3zm2 2v4h4V5H5zm6 6h8v8h-8v-8zm2 2v4h4v-4h-4zM3 13h8v8H3v-8zm2 2v4h4v-4H5zm12-12h4v4h-4V3z"/></svg>Show QR</button></div>
      <div id="goRow" class="gcashRow" title="Tap to copy account" style="background:rgba(0,214,231,.08);border-color:rgba(0,214,231,.35)"><div class="gcashLeft"><svg width="26" height="26" viewBox="0 0 32 32" aria-hidden="true" style="border-radius:999px; box-shadow:0 0 10px rgba(0,214,231,.35)"><defs><linearGradient id="goTeal" x1="0" y1="0" x2="1" y2="1"><stop offset="0" stop-color="#00D6E7"/><stop offset="1" stop-color="#00BFD3"/></linearGradient></defs><rect x="0" y="0" width="32" height="32" rx="16" fill="url(#goTeal)"/><path d="M10.5 16a5.5 5.5 0 1 1 11 0 5.5 5.5 0 0 1-11 0zm2.6 0a2.9 2.9 0 1 0 5.8 0 2.9 2.9 0 0 0-5.8 0z" fill="#00353A" opacity=".95"/></svg>GoTyme ‚Ä¢ <strong id="goNumber">014664932955 ‚Äî MOISES BITONIO</strong></div><button id="showGoQR" type="button" class="qrBtn" title="Show GoTyme QR" style="background:rgba(0,214,231,.14);border-color:rgba(0,214,231,.45);color:#d6fffe"><svg width="18" height="18" viewBox="0 0 24 24" fill="#d6fffe" aria-hidden="true"><path d="M3 3h8v8H3V3zm2 2v4h4V5H5zm6 6h8v8h-8v-8zm2 2v4h4v-4h-4zM3 13h8v8H3v-8zm2 2v4h4v-4H5zm12-12h4v4h-4V3z"/></svg>Show QR</button></div>
      <div class="soc"><a class="btnlink fb" href="https://www.facebook.com/share/p/17MiaRJ24J/" target="_blank" rel="noopener"><svg width="18" height="18" viewBox="0 0 24 24" fill="#fff" aria-hidden="true"><path d="M22 12.07C22 6.48 17.52 2 11.93 2S2 6.48 2 12.07c0 5.01 3.66 9.17 8.44 9.93v-7.02H7.9v-2.91h2.54V9.41c0-2.5 1.49-3.89 3.77-3.89 1.09 0 2.24.2 2.24.2v2.46 h-1.26c-1.24 0-1.63.77-1.63 1.56v1.87h2.78l-.44 2.91h-2.34V22c4.78-.76 8.44-4.92 8.44-9.93z"/></svg>FACEBOOK FEEDBACK</a><a class="btnlink dc" href="https://discord.gg/QkdVz5mh" target="_blank" rel="noopener"><svg width="20" height="20" viewBox="0 0 24 24" fill="#fff" aria-hidden="true"><path d="M20.3 4.4A16 16 0 0015.9 3l-.4.8a13.3 13.3 0 00-7 0L8.1 3A16 16 0 003.7 4.4C1.7 7.5 1 10.5 1.2 13.4a16 16 0 005.9 3l.8-1.3c-.4-.1-.7-.3-1-.4.1-.1.2-.2.3-.3 1.9.9 4 .9 5.9 0l.3.3c-.3.2-.6.3-1 .4l.8 1.3a16 16 0 005.9-3c.3-3-.5-5.9-2.8-9zM9.6 13c-.9 0-1.6-.8-1.6-1.7S8.7 9.6 9.6 9.6s1.6.8 1.6 1.7S10.5 13 9.6 13zm4.8 0c-.9 0-1.6-.8-1.6-1.7s.7-1.7 1.6-1.7 1.6.8 1.6 1.7-.7 1.7-1.6 1.7z"/></svg>DISCORD FEEDBACK</a></div>
    </div>

    <div class="notice"><h4>‚è≥ Waiting Time Notice</h4><p>Processing time may vary depending on server demand. Some servers might experience longer wait times ‚Äî pero <strong>guaranteed matatanggap ang order mo</strong>.</p></div>

    <div class="track"><div class="label" style="margin-bottom:6px">Track Order</div><div style="display:grid;grid-template-columns:1fr auto;gap:10px"><input id="trackIn" class="in" placeholder="Enter Receipt ID (e.g., YMIR-XXXX)" autocomplete="off"><button id="trackBtn" class="btn" style="background:#27252c;color:#fff">Check</button></div><div id="trackOut" style="margin-top:10px;display:none"><div class="chip" style="margin-bottom:8px"><strong id="t_id">‚Äî</strong><span id="t_status" style="opacity:.9"></span></div><div style="display:grid;gap:6px;font-size:14px;color:#ccb9c1"><div>Server: <span id="t_server" style="color:#fff"></span></div><div>Diamonds: <span id="t_qty" style="color:#fff"></span> üíé</div><div>Rate: <span id="t_rate" style="color:#fff"></span></div><div>Total: <span id="t_total" style="color:#fff"></span></div><div>Created: <span id="t_time" style="color:#fff"></span></div></div><div style="display:flex;gap:8px;margin-top:10px;flex-wrap:wrap"><button id="btnPaid" class="btn" style="background:#204c2f;color:#e7fff1">Buyer: I Paid</button></div><div class="hint" style="margin-top:6px">Tip: Buyer taps <b>I Paid</b> after sending payment. (Local tracking only)</div></div><div id="trackNone" class="hint" style="display:none;margin-top:8px">Walang record sa device na ‚Äôto. Note: Tracking works on the same phone/browser (local only).</div></div>
  </div>

  <!-- POPUPS -->
  <div id="buyPopup"><div class="cardPop"><h3>Copied ‚úî</h3><p id="buyMsg"><strong>NA-COPY NA ANG ORDER FORMAT.</strong><br>Open Messenger then paste the order message.</p><div id="buyOrderId" style="margin:10px 0 6px;font-weight:800"></div><button id="closePop" class="btn" style="background:#272327;color:#fff;width:160px;margin:auto">OK</button></div></div>
  <div id="gcashPopup"><div class="cardPop"><h3>GCash number copied ‚úî</h3><p><strong>09162466318 ‚Äî MOISES B.</strong><br>Paste sa GCash Express Send.</p><button id="gcashOk" class="btn" style="background:#272327;color:#fff;width:160px;margin:auto">OK</button></div></div>
  <div id="qrPopup"><div class="cardPop"><h3>GCash QR</h3><p>Scan to pay ‚Ä¢ <strong>MOISES B.</strong></p><img src="gcash-qr.png" alt="GCash QR" class="qrImg"><div style="margin-top:12px"><button id="qrOk" class="btn" style="background:#272327;color:#fff;width:160px;margin:auto">Close</button></div></div></div>
  <div id="goPopup"><div class="cardPop"><h3>GoTyme account copied ‚úî</h3><p><strong>014664932955 ‚Äî MOISES BITONIO</strong><br>Paste sa GoTyme Send Money.</p><button id="goOk" class="btn" style="background:#272327;color:#fff;width:160px;margin:auto">OK</button></div></div>
  <div id="goQRPopup"><div class="cardPop"><h3>GoTyme QR</h3><p>Scan to pay ‚Ä¢ <strong>MOISES BITONIO</strong></p><img src="gotyme-qr.png" alt="GoTyme QR" class="qrImg"><div style="margin-top:12px"><button id="goQROk" class="btn" style="background:#272327;color:#fff;width:160px;margin:auto">Close</button></div></div></div>

  <!-- STOCK MANAGEMENT POPUP -->
  <div id="stockPopup"><div class="cardPop" style="text-align:left">
    <h3 style="margin:0 0 8px">üì¶ Stock Manager</h3>
    <div class="hint">Add/Replace picture & quick edit of the selected server.</div>
    <div style="display:grid;grid-template-columns:88px 1fr;gap:12px;align-items:center;margin:10px 0">
      <img id="stPic" class="qrImg" style="width:88px;height:88px;object-fit:cover;border-radius:10px" src="" alt="preview">
      <div>
        <div class="label" style="margin:0">Server</div>
        <input id="stServer" class="in"/>
        <div class="grid2" style="margin-top:8px">
          <div><div class="label" style="margin:0">Qty</div><input id="stQty" class="in"/></div>
          <div><div class="label" style="margin:0">Notes</div><input id="stNotes" class="in"/></div>
        </div>
      </div>
    </div>
    <div class="hint">Click choose image to attach server photo (stored locally).</div>
    <input id="stFile" type="file" accept="image/*" style="margin:8px 0"/>
    <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
      <button id="stDelPic" class="miniBtn">Remove Picture</button>
      <button id="stSaveOne" class="miniBtn">Save</button>
      <button id="stClose" class="miniBtn">Close</button>
    </div>
  </div></div>

  <!-- MASS UPDATE POPUP -->
  <div id="massPopup"><div class="cardPop" style="text-align:left">
    <h3 style="margin:0 0 8px">üß© Mass Update Stock</h3>
    <div class="hint">Paste CSV lines: <code>Server,Qty,Notes</code>. Existing rows will be updated, new ones will be added.</div>
    <textarea id="massText" class="in" style="height:160px;margin-top:8px" placeholder="ASIA015,3000,Promo\nHOF1,/,Out"></textarea>
    <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
      <button id="massApply" class="miniBtn">Apply</button>
      <button id="massClose" class="miniBtn">Close</button>
    </div>
  </div></div>

  <!-- STOCK VIEW POPUP (Gallery) -->
  <div id="stockViewPopup"><div class="cardPop"><h3 style="margin-top:0">üñºÔ∏è Stock Picture</h3><img id="stockViewImg" class="qrImg" alt="preview"><div style="margin-top:12px"><button id="stockViewClose" class="btn" style="background:#272327;color:#fff;width:160px;margin:auto">Close</button></div></div></div>

<script>
(function(){
  window.addEventListener('error', function(e){try{const t=document.createElement('div');t.textContent='Error: '+(e.message||'unknown');Object.assign(t.style,{position:'fixed',left:'8px',bottom:'8px',background:'rgba(255,0,80,.12)',color:'#fff',padding:'8px 10px',border:'1px solid rgba(255,0,80,.35)',borderRadius:'8px',zIndex:99999,fontSize:'12px',maxWidth:'90vw'});document.body.appendChild(t);setTimeout(()=>t.remove(),5000)}catch(_){}});

  document.addEventListener('DOMContentLoaded',()=>{
    const $=id=>document.getElementById(id);
    const clean=v=>String(v??'').replace(/[^\d.\-]/g,'');
    const toInt=v=>{const m=clean(v).match(/^\d+/);return m?parseInt(m[0],10):0};
    const toNum=v=>{const m=clean(v).match(/^\d+(?:\.\d+)?/);return m?parseFloat(m[0]):0};
    const fmt=n=>Number(n).toLocaleString(undefined,{minimumFractionDigits:2,maximumFractionDigits:2});

    const MIN1=1000,MIN2=4000,MIN3=8000;const T1=0.80,T2=0.75,T3=0.70;

    // ===== STOCK =====
    const STOCK_KEY='ymir_stock_v1';
    const IMG_KEY='ymir_stock_img_v1';
    const DEFAULT_STOCK=[["HOF1","/",""],["DaddyKin","3000",""],["Tokyo","15400",""],["HOF2","2040",""],["DaddyVerse","4912",""],["Kings","6440",""],["HOF3","1000",""],["ManiTW","9000",""],["ISEKAI","35000",""],["Bangkok","1286",""],["PROSGARD","900",""],["X","3900",""],["Chess","7444",""],["XAOU","14269",""],["ASIA015","3000",""],["ASIA016","9000",""],["ASIA017","3200",""],["ASIA018","4500",""],["ASIA020","3000",""],["ASIA021","1500",""],["ASIA023","2000",""],["ASIA024","1400",""],["ASIA025","3000",""],["ASIA027","1500",""],["ASIA028","9300",""]];
    const loadStock=()=>{try{const r=JSON.parse(localStorage.getItem(STOCK_KEY)||'null');if(Array.isArray(r)&&r.length)return r}catch{}return DEFAULT_STOCK.map(r=>[...r])};
    const saveStock=r=>{try{localStorage.setItem(STOCK_KEY,JSON.stringify(r))}catch{}};
    const loadImgs=()=>{try{return JSON.parse(localStorage.getItem(IMG_KEY)||'{}')}catch{return{}}};
    const saveImgs=m=>{try{localStorage.setItem(IMG_KEY,JSON.stringify(m))}catch{}};

    let STOCK=loadStock();
    let IMGS=loadImgs();

    const sBody=$('stockBody');

    function serverIndex(name){return STOCK.findIndex(r=>r[0].toLowerCase()===String(name||'').toLowerCase())}

    function renderStock(){
      sBody.innerHTML='';
      STOCK.forEach((row,i)=>{
        const tr=document.createElement('tr');
        const imgTd=document.createElement('td');
        const img=document.createElement('img');
        const key=row[0]||('row'+i);
        img.src=IMGS[key]||'data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 width=%2244%22 height=%2244%22><rect width=%2244%22 height=%2244%22 fill=%22%23131116%22/><text x=%2250%25%22 y=%2255%25%22 fill=%22%23ff6aa1%22 font-size=%2210%22 text-anchor=%22middle%22>IMG</text></svg>';
        img.className='thumb';
        img.title='Click to view/change picture';
        img.onclick=()=>openStockPopup(i);
        imgTd.appendChild(img);

        const tdS=document.createElement('td');tdS.contentEditable=true;tdS.textContent=row[0];
        const tdQ=document.createElement('td');tdQ.contentEditable=true;tdQ.textContent=row[1];
        const tdN=document.createElement('td');tdN.contentEditable=true;tdN.textContent=row[2]||'';
        const tdA=document.createElement('td');const del=document.createElement('button');del.className='miniBtn';del.textContent='Delete';del.onclick=()=>{STOCK.splice(i,1);saveStock(STOCK);renderStock();updateServerDatalist()};tdA.appendChild(del);
        [tdS,tdQ,tdN].forEach((td,idx)=>td.addEventListener('input',()=>{row[idx]=td.textContent.trim();saveStock(STOCK);updateServerDatalist()}));
        tr.append(imgTd,tdS,tdQ,tdN,tdA);sBody.appendChild(tr);
      });
    }

    function updateServerDatalist(){
      const list=$('serverList');const val=$('serverIn').value;list.innerHTML='';
      STOCK.map(r=>r[0]).filter(Boolean).forEach(name=>{const o=document.createElement('option');o.value=name;list.appendChild(o)});
      $('serverIn').value=val;updateAvailNote();
    }

    function getStockQty(server){
      const r=STOCK.find(x=>x[0].toLowerCase()===String(server||'').toLowerCase());
      const q=r?parseInt(String(r[1]).replace(/[^\d]/g,''),10):NaN;return isNaN(q)?null:q;
    }

    function updateAvailNote(){
      const s=$('serverIn').value.trim();const note=$('availNote');
      if(!s){note.style.display='none';return}
      const q=getStockQty(s);
      if(q==null){note.textContent='No stock record for this server';note.style.display='block';note.style.color='#ffd4e1'}
      else{note.textContent=`Available stock: ${q.toLocaleString()} üíé`;note.style.display='block';note.style.color='#b0ffa6'}
    }

    // Buttons
    $('sAdd').onclick=()=>{STOCK.push(['','/','']);saveStock(STOCK);renderStock();updateServerDatalist()};
    $('sSave').onclick=()=>{saveStock(STOCK);flash('Stock saved')};
    $('sReset').onclick=()=>{if(confirm('Reset stock to defaults?')){STOCK=DEFAULT_STOCK.map(r=>[...r]);saveStock(STOCK);renderStock();updateServerDatalist()}};
    $('sCSV').onclick=()=>{const rows=[["server","qty","notes"],...STOCK];const csv=rows.map(r=>r.map(x=>`"${String(x).replaceAll('"','""')}"`).join(',')).join('\n');downloadText('ymir_stock.csv',csv)};
    $('sPop').onclick=()=>{openStockPopup(0)};
    $('sMass').onclick=()=>{$('massPopup').style.display='grid'};

    // Stock Popup logic
    let curIdx=0;
    function openStockPopup(i){curIdx=i;const row=STOCK[i]||['','',''];$('stServer').value=row[0]||'';$('stQty').value=row[1]||'';$('stNotes').value=row[2]||'';const key=row[0]||('row'+i);$('stPic').src=IMGS[key]||'';$('stockPopup').style.display='grid'}
    $('stClose').onclick=()=>{$('stockPopup').style.display='none'};
    $('stDelPic').onclick=()=>{const name=$('stServer').value||('row'+curIdx);delete IMGS[name];saveImgs(IMGS);$('stPic').src='';flash('Picture removed')};
    $('stFile').addEventListener('change',e=>{const file=e.target.files&&e.target.files[0];if(!file)return;const reader=new FileReader();reader.onload=()=>{$('stPic').src=reader.result};reader.readAsDataURL(file)});
    $('stSaveOne').onclick=()=>{const name=$('stServer').value.trim();const qty=$('stQty').value.trim();const notes=$('stNotes').value.trim();STOCK[curIdx]=[name,qty,notes];saveStock(STOCK);updateServerDatalist();renderStock();const imgSrc=$('stPic').src||'';if(imgSrc)IMGS[name]=imgSrc;saveImgs(IMGS);flash('Stock updated');$('stockPopup').style.display='none'};

    // Mass Update
    $('massApply').onclick=()=>{const txt=$('massText').value.trim();if(!txt){$('massPopup').style.display='none';return}txt.split(/\r?\n/).forEach(line=>{const parts=line.split(',');if(!parts[0])return;const name=parts[0].trim();const qty=(parts[1]||'').trim();const notes=(parts[2]||'').trim();const idx=serverIndex(name);if(idx>-1){STOCK[idx]=[name,qty,notes]}else{STOCK.push([name,qty,notes])}});saveStock(STOCK);renderStock();updateServerDatalist();flash('Mass update applied');$('massPopup').style.display='none'};
    $('massClose').onclick=()=>{$('massPopup').style.display='none'};

    function downloadText(filename,text){const a=document.createElement('a');a.href=URL.createObjectURL(new Blob([text],{type:'text/plain'}));a.download=filename;a.click();URL.revokeObjectURL(a.href)}
    function flash(text){const el=document.createElement('div');el.textContent=text;el.style.cssText='position:fixed;inset:auto auto 20px 50%;transform:translateX(-50%);background:#ffb45a;color:#2b1200;padding:10px 14px;border-radius:999px;font-weight:800;box-shadow:0 10px 20px rgba(0,0,0,.45);z-index:9999';document.body.appendChild(el);setTimeout(()=>el.remove(),1400)}

    // ===== RATE/ORDER =====
    const diasEl=$('dias'),phpEl=$('phpIn'),serverEl=$('serverIn');
    const rateOut=$('rateOut'),saveOut=$('saveOut'),warn=$('warn'),buyBtn=$('buyBtn');
    function getRate(q){if(!q||q<MIN1)return null;if(q<MIN2)return T1;if(q<MIN3)return T2;return T3}
    function estimateFromPHP(p){if(!p||p<=0)return 0;let q=Math.floor(p/T1);for(let i=0;i<4;i++){const r=getRate(q)??T1;q=Math.floor(p/r)}return q}
    function paintPills(q,r){const p80=$('pill80'),p75=$('pill75'),p70=$('pill70');[p80,p75,p70].forEach(p=>p.classList.remove('active','lock','flame','best'));if(!q||q<MIN1){p80.classList.add('lock');p75.classList.add('lock');p70.classList.add('lock');return}if(q<MIN2)p75.classList.add('lock');if(q<MIN3)p70.classList.add('lock');if(r===T1)p80.classList.add('active');if(r===T2)p75.classList.add('active');if(r===T3){p70.classList.add('active','flame','best')}}

    let lastEdited=null;const validServer=()=>serverEl.value.trim().length>0;
    function recalc(){
      let q=toInt(diasEl.value);let p=toNum(phpEl.value);
      if(lastEdited==='p'){q=estimateFromPHP(p);diasEl.value=q?String(q):''}
      else if(lastEdited==='d'){const r=getRate(q);phpEl.value=(r&&q)?fmt(q*r):''}
      else{if(!q&&p){q=estimateFromPHP(p);diasEl.value=q?String(q):''}if(q&&!p){const r=getRate(q);phpEl.value=r?fmt(q*r):''}}
      const r=getRate(q);paintPills(q,r);
      updateAvailNote();
      const sQty=getStockQty(serverEl.value.trim());const notExceed=(sQty==null)?true:(q<=sQty);
      const ok=q>=MIN1&&!!r&&validServer()&&notExceed;warn.style.display=ok?'none':'block';buyBtn.disabled=!ok;
      if(r&&q){rateOut.textContent=`‚Ç±${r.toFixed(2)} / dia`;const base=q*T1,saveAmt=Math.max(0,base-(q*r));const savePct=Math.max(0,(1-r/T1)*100);saveOut.textContent=`${savePct.toFixed(2)}% ‚Ä¢ ‚Ç±${fmt(saveAmt)}`}else{rateOut.textContent='‚Äî';saveOut.textContent='‚Äî'}
    }
    ['input','change','keyup'].forEach(ev=>{diasEl.addEventListener(ev,()=>{lastEdited='d';recalc()});phpEl.addEventListener(ev,()=>{lastEdited='p';recalc()});serverEl.addEventListener(ev,recalc)});

    // ORDER COPY FORMAT (new text)
    function buildOrderMessage(q,r,total){
      const s=serverEl.value.trim();
      return `‚Äî YMIR ORDER ‚Äî\nüíé Diamonds: ${q}\nüõ°Ô∏è Server: ${s}\nüí∞ Rate: ‚Ç±${r.toFixed(2)} / dia\nüßæ Total: ‚Ç±${fmt(total)}\nüì± GCash: 09162466318 (MOISES B.)\n\nPlease confirm IGN + Server. Thanks!`;
    }

    $('buyBtn').addEventListener('click',async()=>{
      let q=toInt(diasEl.value);let p=toNum(phpEl.value);if(!q&&p)q=estimateFromPHP(p);const r=getRate(q);if(!r||!serverEl.value.trim()){recalc();return}const total=p||(q*r);
      const msg=buildOrderMessage(q,r,total);
      try{await navigator.clipboard.writeText(msg)}catch{}
      $('buyOrderId').textContent='Order format copied to clipboard';
      $('buyPopup').style.display='grid';
    });
    $('closePop').addEventListener('click',()=>$('buyPopup').style.display='none');

    // Tracking
    const STORE_KEY='ymir_orders';
    const loadOrders=()=>{try{return JSON.parse(localStorage.getItem(STORE_KEY)||'{}')}catch{return{}}};
    const saveOrders=m=>{try{localStorage.setItem(STORE_KEY,JSON.stringify(m))}catch{}};
    function genRID(){const t=Date.now().toString(36).toUpperCase();const r=Math.random().toString(36).slice(2,6).toUpperCase();return `YMIR-${t}-${r}`}
    function setStatusUI(status){const s=$('t_status');s.textContent=status;s.style.color=status==='DELIVERED'?'#ff8aa0':status==='PAID'?'#22cf74':'#ffd64d'}

    // Secret delivered (still available) + deduct
    let tapCount=0,tapTimer=null;
    $('secretLogo').addEventListener('click',()=>{tapCount++;clearTimeout(tapTimer);tapTimer=setTimeout(()=>tapCount=0,900);if(tapCount>=6){tapCount=0;const id=$('trackIn').value.trim();const map=loadOrders();if(!map[id])return;map[id].status='DELIVERED';saveOrders(map);setStatusUI('DELIVERED');const rec=map[id];const idx=serverIndex(rec.server);if(idx>-1){const cur=parseInt(String(STOCK[idx][1]).replace(/[^\d]/g,''),10);if(!isNaN(cur)){STOCK[idx][1]=String(Math.max(0,cur-(parseInt(rec.qty,10)||0)));saveStock(STOCK);renderStock();updateServerDatalist();flash('Stock updated: delivered deducted')}}}});

    // View image in gallery popup when clicking thumbnail (already handled via openStockPopup). Add separate viewer when we have only image
    // GCash / GoTyme
    (function(){const row=$('gcashRow'),pop=$('gcashPopup'),ok=$('gcashOk');row.addEventListener('click',async()=>{try{await navigator.clipboard.writeText('09162466318')}catch{}pop.style.display='grid'});ok.addEventListener('click',()=>pop.style.display='none')})();
    (function(){const btn=$('showQR'),modal=$('qrPopup'),close=$('qrOk');btn.addEventListener('click',()=>modal.style.display='grid');close.addEventListener('click',()=>modal.style.display='none')})();
    (function(){const row=$('goRow'),pop=$('goPopup'),ok=$('goOk');row.addEventListener('click',async()=>{try{await navigator.clipboard.writeText('014664932955')}catch{}pop.style.display='grid'});ok.addEventListener('click',()=>pop.style.display='none')})();
    (function(){const btn=$('showGoQR'),modal=$('goQRPopup'),close=$('goQROk');btn.addEventListener('click',()=>modal.style.display='grid');close.addEventListener('click',()=>modal.style.display='none')})();

    // init
    renderStock();updateServerDatalist();recalc();
  });
})();
</script>
</body>
</html>
